#pragma once

#define INTERNAL_EXPAND(x) x
#ifdef _MSC_VER // Microsoft compilers
#define VA_NARGS(...)  INTERNAL_EXPAND_ARGS_PRIVATE(INTERNAL_ARGS_AUGMENTER(__VA_ARGS__))

#define INTERNAL_ARGS_AUGMENTER(...) unused, __VA_ARGS__
#define INTERNAL_EXPAND_ARGS_PRIVATE(...) INTERNAL_EXPAND(INTERNAL_GET_ARG_COUNT_PRIVATE(__VA_ARGS__, \
                                                                        70, 69, 68, 67, 66, 65, 64, 63, 62, 61, 60, \
                                                                        59, 58, 57, 56, 55, 54, 53, 52, 51, 50, \
                                                                        49, 48, 47, 46, 45, 44, 43, 42, 41, 40, \
                                                                        39, 38, 37, 36, 35, 34, 33, 32, 31, 30, \
                                                                        29, 28, 27, 26, 25, 24, 23, 22, 21, 20, \
                                                                        19, 18, 17, 16, 15, 14, 13, 12, 11, 10, \
                                                                        9, 8, 7, 6, 5, 4, 3, 2, 1, 0))

#define INTERNAL_GET_ARG_COUNT_PRIVATE(_0__, _1__, _2__, _3__, _4__, _5__, _6__, _7__, _8__, _9__, _10__, \
                                      _11__, _12__, _13__, _14__, _15__, _16__, _17__, _18__, _19__, _20__, \
                                      _21__, _22__, _23__, _24__, _25__, _26__, _27__, _28__, _29__, _30__, \
                                      _31__, _32__, _33__, _34__, _35__, _36__, _37__, _38__, _39__, _40__, \
                                      _41__, _42__, _43__, _44__, _45__, _46__, _47__, _48__, _49__, _50__, \
                                      _51__, _52__, _53__, _54__, _55__, _56__, _57__, _58__, _59__, _60__, \
                                      _61__, _62__, _63__, _64__, _65__, _66__, _67__, _68__, _69__, _70__, count, ...) count
#else // Non-Microsoft compilers

#define VA_NARGS(...) INTERNAL_GET_ARG_COUNT_PRIVATE(0, ## __VA_ARGS__, 70, 69, 68, 67, 66, 65, 64, 63, 62, 61, 60, \
                                                                        59, 58, 57, 56, 55, 54, 53, 52, 51, 50, \
                                                                        49, 48, 47, 46, 45, 44, 43, 42, 41, 40, \
                                                                        39, 38, 37, 36, 35, 34, 33, 32, 31, 30, \
                                                                        29, 28, 27, 26, 25, 24, 23, 22, 21, 20, \
                                                                        19, 18, 17, 16, 15, 14, 13, 12, 11, 10, \
                                                                        9, 8, 7, 6, 5, 4, 3, 2, 1, 0)

#define INTERNAL_GET_ARG_COUNT_PRIVATE(_0__, _1__, _2__, _3__, _4__, _5__, _6__, _7__, _8__, _9__, _10__, \
                                      _11__, _12__, _13__, _14__, _15__, _16__, _17__, _18__, _19__, _20__, \
                                      _21__, _22__, _23__, _24__, _25__, _26__, _27__, _28__, _29__, _30__, \
                                      _31__, _32__, _33__, _34__, _35__, _36__, _37__, _38__, _39__, _40__, \
                                      _41__, _42__, _43__, _44__, _45__, _46__, _47__, _48__, _49__, _50__, \
                                      _51__, _52__, _53__, _54__, _55__, _56__, _57__, _58__, _59__, _60__, \
                                      _61__, _62__, _63__, _64__, _65__, _66__, _67__, _68__, _69__, _70__, count, ...) count
#endif